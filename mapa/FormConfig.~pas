(**
---------------------------------------------------------------------------------------------------------------------------------------------------------------
Copyright 2000, 2001, 2002, 2003, 2004, 2005 Dataprev - Empresa de Tecnologia e Informações da Previdência Social, Brasil

Este arquivo é parte do programa CACIC - Configurador Automático e Coletor de Informações Computacionais

O CACIC é um software livre; você pode redistribui-lo e/ou modifica-lo dentro dos termos da Licença Pública Geral GNU como
publicada pela Fundação do Software Livre (FSF); na versão 2 da Licença, ou (na sua opinião) qualquer versão.

Este programa é distribuido na esperança que possa ser  util, mas SEM NENHUMA GARANTIA; sem uma garantia implicita de ADEQUAÇÂO a qualquer
MERCADO ou APLICAÇÃO EM PARTICULAR. Veja a Licença Pública Geral GNU para maiores detalhes.

Você deve ter recebido uma cópia da Licença Pública Geral GNU, sob o título "LICENCA.txt", junto com este programa, se não, escreva para a Fundação do Software
Livre(FSF) Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
---------------------------------------------------------------------------------------------------------------------------------------------------------------
*)

unit FormConfig;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, StdCtrls,main_mapa, PJVersionInfo, NTFileSecurity, ExtCtrls;

type
  TConfigs = class(TForm)
    Button_Gravar: TButton;
    PJVersionInfo1: TPJVersionInfo;
    btCancelaOperacao: TButton;
    pnConfiguracoes: TPanel;
    Label_ip_serv_cacic: TLabel;
    Edit_ip_serv_cacic: TEdit;
    Label_cacic_dir: TLabel;
    Edit_cacic_dir: TEdit;
    lbConfiguracoes: TLabel;
    pnVersao: TPanel;
    Label2: TLabel;
    procedure Button_GravarClick(Sender: TObject);
    procedure Edit_ip_serv_cacicExit(Sender: TObject);
    procedure Edit_cacic_dirExit(Sender: TObject);
    procedure GravaConfiguracoes;
    procedure btCancelaOperacaoClick(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  Configs: TConfigs;
  v_ip_serv_cacic,
  v_cacic_dir : String;


implementation

{$R *.dfm}

procedure TConfigs.Button_GravarClick(Sender: TObject);
begin
  Configs.GravaConfiguracoes;
  Close;
end;

procedure TConfigs.GravaConfiguracoes;
var mapa_ini : TextFile;
begin
   try
       FileSetAttr (ExtractFilePath(Application.Exename) + '\MapaCacic.ini',0); // Retira os atributos do arquivo para evitar o erro FILE ACCESS DENIED em máquinas 2000
       AssignFile(mapa_ini,ExtractFilePath(Application.Exename) + '\MapaCacic.ini'); {Associa o arquivo a uma variável do tipo TextFile}
       Rewrite (mapa_ini); // Recria o arquivo...
       Append(mapa_ini);
       Writeln(mapa_ini,'');
       Writeln(mapa_ini,'# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #');
       Writeln(mapa_ini,'# CHAVES E VALORES OBRIGATÓRIOS PARA USO DO MapaCacic.exe                          #');
       Writeln(mapa_ini,'# =================================================================  #');
       Writeln(mapa_ini,'# ip_serv_cacic                                                                                                             #');
       Writeln(mapa_ini,'#          IP ou Identificação do servidor onde o Módulo Gerente do CACIC foi instalado#');
       Writeln(mapa_ini,'#          Ex.: ip_serv_cacic=UXRJO115                                                                          #');
       Writeln(mapa_ini,'#               ip_serv_cacic=10.xxx.yyy.zzz                                                                    #');
       Writeln(mapa_ini,'# cacic_dir                                                                                                           #');
       Writeln(mapa_ini,'#          Pasta a ser criada na estação para instalação do CACIC agente                    #');
       Writeln(mapa_ini,'#          Ex.: cacic_dir=Cacic                                                                                          #');
       Writeln(mapa_ini,'# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #');
       Writeln(mapa_ini,'');
       Writeln(mapa_ini,'[Cacic2]');

       // Atribuição dos valores do form FormConfig às variáveis...
       v_ip_serv_cacic                 := Configs.Edit_ip_serv_cacic.text;
       v_cacic_dir                     := Configs.Edit_cacic_dir.text;

       // Escrita dos parâmetros obrigatórios
       Writeln(mapa_ini,'ip_serv_cacic='+v_ip_serv_cacic);
       Writeln(mapa_ini,'cacic_dir='+v_cacic_dir);

       CloseFile(mapa_ini); {Fecha o arquivo texto}
   except
   end;
end;

procedure TConfigs.Edit_ip_serv_cacicExit(Sender: TObject);
begin
if trim(Edit_ip_serv_cacic.Text) = '' then Edit_ip_serv_cacic.SetFocus;
end;

procedure TConfigs.Edit_cacic_dirExit(Sender: TObject);
begin
if trim(Edit_cacic_dir.Text) = '' then Edit_cacic_dir.Text := 'Cacic';
end;

procedure TConfigs.btCancelaOperacaoClick(Sender: TObject);
begin
  Application.Terminate;
end;

end.
